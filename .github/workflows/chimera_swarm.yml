name: Chimera Reborn (with Reporter)

on:
  workflow_dispatch:

jobs:
  strike:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        target: [ "hackerone.com", "bugcrowd.com", "tesla.com" ]
    steps:
      - name: Checkout Project Code
        uses: actions/checkout@v4

      - name: Install Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Python Dependencies
        run: pip install requests

      - name: Install Recon Tools
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: Run Real Recon Drone
        run: |
          chmod +x run_drone.sh
          ./run_drone.sh ${{ matrix.target }}

      - name: Analyze and Report
        if: always()
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          python reporter.py ${{ matrix.target }}

      - name: Upload Recon Results
        if: always()
        uses: actions/upload-artifact@v4-stable
        with:
          name: recon-results-${{ matrix.target }}
          path: recon_results/
